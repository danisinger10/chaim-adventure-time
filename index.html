<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chaim’s Adventure</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Framer Motion (UMD) -->
  <script src="https://unpkg.com/framer-motion/dist/framer-motion.umd.js"></script>

  <style>
    /* Neon-noir palette */
    :root{
      --bg-main:#0e0e1a;
      --bg-accent:#131327;
      --txt-primary:#e6e6ff;
      --neon:#ff007a;
      --neon-alt:#00e8ff;
    }
    body{
      background:var(--bg-main);
      color:var(--txt-primary);
      overscroll-behavior:none;
      font-family:Inter,system-ui,Arial,sans-serif;
    }
    /* Parallax background layers */
    .layer{
      position:fixed;
      top:0;left:0;width:100%;height:100%;
      background-position:center;
      background-size:cover;
      pointer-events:none;
      will-change:transform;
    }
    #layer1{background-image:linear-gradient(120deg,#0e0e1a 0%,#131327 100%);}
    #layer2{background-image:url('https://images.unsplash.com/photo-1520052205866-2b46334a39d5?auto=format&fit=crop&w=1200&q=60');opacity:.15;}
    #layer3{background-image:url('https://images.unsplash.com/photo-1520170143950-a8e25d3bb90d?auto=format&fit=crop&w=1200&q=60');opacity:.10;}

    /* Choice buttons */
    .choice{
      background:var(--bg-accent);
      border:2px solid var(--neon);
      padding:.75rem 1.25rem;
      margin:.5rem 0;
      border-radius:.375rem;
      font-weight:600;
      transition:all .2s;
    }
    .choice:hover{background:var(--neon);color:#000;}

    /* Neon headline */
    h1{
      font-size:2rem;
      font-weight:700;
      color:var(--neon-alt);
      text-shadow:0 0 6px var(--neon-alt);
    }
  </style>
</head>
<body>

<div id="layer1" class="layer"></div>
<div id="layer2" class="layer"></div>
<div id="layer3" class="layer"></div>

<!-- Game container -->
<div id="app" class="relative min-h-screen flex items-center justify-center p-6">
  <!-- Framer Motion wrapper -->
  <div id="sceneRoot" class="max-w-lg w-full"></div>
</div>

<!-- The entire branching engine + story inline -->
<script type="module">
/* ---------- PARALLAX SCROLL ---------- */
const layers=[document.getElementById('layer2'),document.getElementById('layer3')];
window.addEventListener('scroll',()=>{const y=window.scrollY;
  layers[0].style.transform=\`translateY(\${y*0.2}px)\`;
  layers[1].style.transform=\`translateY(\${y*0.4}px)\`;
});

/* ---------- STORY DATA ---------- */
const story={
  start:'heist_intro',
  passages:{
    heist_intro:{
      text:`# Prologue  
The rain hammers neon streets. You’re clutching the micro-drive with **₿48 million** in unlaundered crypto. Sirens wail.

A shadowy figure darts from the alley—gun drawn. You’ve got seconds to react.`,
      choices:[
        {text:'Run for the subway vents',next:'vents_escape',flag:'athletic'},
        {text:'Duck into the night market',next:'market_mingle'},
        {text:'Face the gunman head-on',next:'standoff',flag:'brave'}
      ]
    },
    vents_escape:{
      text:`You vault the railing, slide into the maintenance vent, and the city’s heartbeat dulls behind steel.  
Hot air blasts your face. A red sensor blinks ahead.`,
      choices:[
        {text:'Crawl forward, risk the sensor',next:'sensor_trip'},
        {text:'Backtrack and find another route',next:'backtrack'}
      ]
    },
    market_mingle:{
      text:`Steam, spices, counterfeit tech—chaos everywhere. The gunman loses your trail, but two undercover agents spot the blood-stained drive in your hand.`,
      choices:[
        {text:'Blend with the crowd',next:'crowd_blend'},
        {text:'Offer bribe to agents',next:'bribe_attempt'}
      ]
    },
    standoff:{
      text:`Your stare could cut glass. The gunman smirks.  
> “Hand it over or paint the street.”  
You notice his finger trembles.`,
      choices:[
        {text:'Throw a flash pellet (you always carry one)',next:'flashbang'},
        {text:'Negotiate—stall for backup',next:'negotiate'}
      ]
    },
    // … add more passages / endings …
  }
};

/* ---------- SAVE / LOAD ---------- */
const saveKey='chaim_adventure_save';
function save(state){ localStorage.setItem(saveKey,JSON.stringify(state)); }
function load(){ return JSON.parse(localStorage.getItem(saveKey)); }

/* ---------- RENDER ENGINE ---------- */
import { motion, animate } from 'https://cdn.skypack.dev/framer-motion@10.16.1';
const root=document.getElementById('sceneRoot');

function mdToHtml(md){
  // super-light Markdown → HTML
  return md
    .replace(/^# (.*$)/gim,'<h1>$1</h1>')
    .replace(/^> (.*$)/gim,'<blockquote>$1</blockquote>')
    .replace(/\*\*(.*?)\*\*/gim,'<strong>$1</strong>')
    .replace(/\n/g,'<br>');
}

function render(sceneId,state){
  const node=story.passages[sceneId];
  if(!node){alert('Scene missing:'+sceneId);return;}
  state.current=sceneId; save(state);

  // wipe & animate container
  root.innerHTML='';
  const scene=document.createElement('div');
  scene.className='bg-[rgba(0,0,0,0.6)] backdrop-blur-md p-6 rounded-xl shadow-xl';
  scene.innerHTML=\`<div class="prose prose-invert">\${mdToHtml(node.text)}</div>\`;

  node.choices.forEach(ch=>{
    const btn=document.createElement('button');
    btn.className='choice';
    btn.textContent=ch.text;
    btn.onclick=()=>{ if(ch.flag)state.flags[ch.flag]=true; render(ch.next,state); };
    scene.appendChild(btn);
  });

  root.appendChild(scene);

  // Framer fade/slide
  motion(scene).from({opacity:0,y:40}).to({opacity:1,y:0},{duration:0.6});
}

function start(){
  const state=load()||{flags:{},current:story.start};
  render(state.current,state);
}
start();
</script>

</body>
</html>