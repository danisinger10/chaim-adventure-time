<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chaim’s Adventure</title>

    <!-- TailwindCSS CDN for quick styling -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      /* Simple parallax background holder */
      #scene {
        background-size: cover;
        background-position: center;
        transition: background-image 0.6s ease-out;
      }
    </style>
  </head>
  <body class="min-h-screen bg-gray-900 text-gray-100 flex flex-col items-center justify-start p-4">
    <h1 class="text-3xl font-bold mb-4">Chaim’s Adventure</h1>

    <!-- Scene container -->
    <div id="scene" class="w-full max-w-3xl p-6 rounded-xl bg-gray-800 shadow-lg mb-6 whitespace-pre-wrap leading-relaxed"></div>

    <!-- Choices container -->
    <div id="choices" class="w-full max-w-3xl flex flex-col items-stretch gap-3"></div>

    <!-- Dev console for quick saves (hidden) -->
    <textarea id="saveData" class="hidden"></textarea>

    <!-- Game logic -->
    <script type="module">
      import StoryEngine, { demoStory } from './branching_story_engine.js';

      const sceneEl = document.getElementById('scene');
      const choicesEl = document.getElementById('choices');

      // Restore save (if any)
      const saved = localStorage.getItem('chaimAdventureSave');

      const engine = new StoryEngine({
        data: demoStory,
        onScene: ({ text, img, visibleChoices }) => {
          sceneEl.innerHTML = marked.parse(text); // markdown -> HTML (if marked.js loaded)
          sceneEl.style.backgroundImage = img ? `url(${img})` : 'none';

          // render choices
          choicesEl.innerHTML = '';
          if (!visibleChoices.length && !img) {
            const endMsg = document.createElement('p');
            endMsg.textContent = 'THE END — refresh to replay';
            choicesEl.appendChild(endMsg);
            return;
          }
          visibleChoices.forEach((c, i) => {
            const btn = document.createElement('button');
            btn.className = 'px-4 py-2 rounded bg-purple-700 hover:bg-purple-600 active:scale-95 transition';
            btn.textContent = c.text;
            btn.onclick = () => engine.choose(i);
            choicesEl.appendChild(btn);
          });

          // autosave after scene render
          localStorage.setItem('chaimAdventureSave', engine.save());
        },
      });

      if (saved) {
        try { engine.load(saved); } catch (e) { console.error(e); engine.start(); }
      } else {
        engine.start();
      }
    </script>

    <!-- Optional marked.js for Markdown support -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  </body>
</html>